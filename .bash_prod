ssr_copy_settings_files() {
  if [ -f "web/sites/default/settings.local.php" ]; then
    rm -f "web/sites/default/settings.local.php"
  fi

  if [ -f "web/sites/default/settings.common-local.php" ]; then
    rm -f "web/sites/default/settings.common-local.php"
  fi

  if [ -f ".settings/local/settings.local.php" ]; then
    cp ".settings/local/settings.local.php" "web/sites/default/settings.local.php" || echo "Failed to copy settings.local.php"
  fi

  if [ -f ".settings/prod/settings.common-local.php" ]; then
    cp ".settings/prod/settings.common-local.php" "web/sites/default/settings.common-local.php" || echo "Failed to copy settings.common-local.php"
  fi
}

alias ssr_deploy_local="drush state:set system.maintenance_mode 1 --input-format=integer &&
git pull &&
chmod +w web/sites/default/ &&
ssr_copy_settings_files &&
chmod -w web/sites/default/settings.local.php &&
composer install &&
drush cr &&
drush deploy &&
drush deploy &&
drush locale-check &&
drush locale-update &&
drush cr &&
drush php-eval 'if (function_exists(\"simple_school_reports_module_info_deploy\")) { simple_school_reports_module_info_deploy(); }' &&
drush state:set system.maintenance_mode 0 --input-format=integer &&
drush cr &&
chmod -w web/sites/default/"

### Prod specific secret
if [ -f ~/.bash_prod_local ]; then
    . ~/.bash_prod_local
fi
